matrix:
  include:
    - compiler: gcc
      env: testenv="linux gcc"
    - compiler: gcc
      sudo: true
      dist: trusty
      env: testenv="linux gcc-6"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - g++-6
            - qt5-default
            - libqt5opengl5-dev
            - lib32stdc++6
            - qtmultimedia5-dev
      before_script:
        - export CC=gcc-6
        - export CXX=g++-6
    - compiler: clang
      env: testenv="linux clang"
    - language: objective-c
      env: testenv="os x cocoa port"
      os: osx
      compiler: clang
      before_script:
        - cd ../src
        - echo 'INCLUDE_DIRECTORIES("/opt/X11/include")' > temp.txt
        - echo 'LINK_DIRECTORIES("/opt/X11/lib")' >> temp.txt
        - cat temp.txt CMakeLists.txt > temp2.txt
        - rm CMakeLists.txt
        - mv temp2.txt CMakeLists.txt
        - cd ../build
      script:
        - cmake -DCMAKE_BUILD_TYPE=Release ..
        - make
      after_success:
        - cpack -G ZIP -D CPACK_PACKAGE_FILE_NAME=yabause-v${GIT_RELEASE_VERSION}.${TRAVIS_BUILD_NUMBER}-mac
    - os: osx
      env: testenv="os x qt port"
      compiler: clang
      script:
        - brew install qt5 sdl2
        - cmake -DCMAKE_PREFIX_PATH=/usr/local/Cellar/qt5/5.3.2 -DYAB_PORTS=qt -DCMAKE_BUILD_TYPE=Release ..
        - make
    - compiler: gcc
      env: testenv="mingw-w64 windows cross compile, libyabause only"
      addons:
        apt:
          packages:
          - gcc-mingw-w64-x86-64
          - g++-mingw-w64-x86-64
          - binutils-mingw-w64-x86-64
          - mingw-w64-x86-64-dev
      script:
        - echo 'SET(CMAKE_SYSTEM_NAME Windows)' > toolchain.cmake
        - echo 'SET(CMAKE_C_COMPILER   x86_64-w64-mingw32-gcc)' >> toolchain.cmake
        - echo 'SET(CMAKE_CXX_COMPILER x86_64-w64-mingw32-g++)' >> toolchain.cmake
        - echo 'SET(CMAKE_RC_COMPILER x86_64-w64-mingw32-windres)' >> toolchain.cmake
        - cmake -DCMAKE_TOOLCHAIN_FILE=toolchain.cmake -DYAB_PORTS= ..
        - make
      after_success:
        - cpack -G ZIP -D CPACK_PACKAGE_FILE_NAME=yabause-v${GIT_RELEASE_VERSION}.${TRAVIS_BUILD_NUMBER}-win64
    - compiler: gcc
      env: testenv="android port"
      jdk: oraclejdk8
      language: android
      android:
        components:
          - tools
          - tools
          - platform-tools
          - build-tools-24.0.1
          - android-24
      script:
        - wget http://dl.google.com/android/repository/android-ndk-r11c-linux-x86_64.zip
        - unzip -q android-ndk-r11c-linux-x86_64.zip
        - export ANDROID_NDK_HOME=$(pwd)/android-ndk-r11c/
        - cmake -DCMAKE_BUILD_TYPE=Release -DSH2_DYNAREC=OFF -DCMAKE_TOOLCHAIN_FILE=../src/android/armeabi.cmake -DYAB_PORTS=android ..
        - make
env:
 - global:
    # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
    # via the "travis encrypt" command using the project repo's public key
addons:
  coverity_scan:
    project:
      name: Yabause/yabause
      description: Build submitted via Travis CI
    notification_email: guillaume.duhamel@gmail.com
    build_command_prepend: cmake ..;
    build_command: make
    branch_pattern: coverity_scan
language: cpp
sudo: false
before_install:
- if ([[ "${TRAVIS_JOB_NUMBER##*.}" != "1" ]] && [[ "${TRAVIS_BRANCH}" == "coverity_scan" ]]); then false ; fi
- cd yabause
- mkdir build
- cd build
script:
- cmake -DYAB_WERROR=ON -DYAB_FORCE_SECURE_STRINGS=ON ..
- make
before_deploy:
- git config --local user.name ${GIT_USER}
- git config --local user.email ${GIT_MAIL}
- git tag "v${GIT_RELEASE_VERSION}.${TRAVIS_BUILD_NUMBER}"
deploy:
  provider: releases
  api_key:
    secure: oYQp54i5P9hs27pWaBuhgvVQGnLi7bVxoErINkP1Iu0PPv6jfq9YVS+MvbWi8+VWBrV7F1l+6xe9jeA41P+9y9+KnIgoO9+57H28Apgr9+yrbt/JqtM2o56Yrrpl9PJPaG82aBT5kRMxvPBHpWP0p3aCOcTt9oNM3AEipbyiS1bcA02l7CEqPtVh19gO79jqxXTainkdmFChRVYhlnbIIuSleGuBrtbnnUfwiZ94anqj4hOz+A9EyWIa/FtC2J3s4dV6USXoiiuGuw2ekvXI6YfQyTOdtmWLqmp+LAHdOvnSKMP10JBKy1Vi4EJ8RHt0X160wBLPXsN0mngx1OmPAWwfrBgZ5eu187w1GKQHMHk4/l4exVqNhW3t8mSNMwdCBu80mF3HL/qWfkdKiA1Ryeq/t18usMLNCKRcKgeQ3OsigZSTvDZMg7xLSNOkcZ/XpURR0RABvhUMkRLdsrsnKs8DdLo++dTHWPr01hWXucq+cp3LYtuRLMmJrzzTZbNC7vUC1gnEtypZQ98B92B5hn9hO/+BpY+k1csYPtgPJMofOqliWs79YNe6HsctH4WnEJKXaPWRPse16PzPTT4ENjHZRV407erqvjx56i79BbE44caXHZA0kwQkhxD9WTfvvS+3Bm71BuNs73pV2D+NHNGEy5uJmMeQCrBXo4dghFc=
  file_glob: true
  file: 'yabause-v${GIT_RELEASE_VERSION}.${TRAVIS_BUILD_NUMBER}*'
  on:
    repo: b23prodtm/yabause
    branch: feature/*
